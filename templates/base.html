<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WifiScanner Web</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  </head>
  <body class="bg-light">
    <div id="loadingOverlay" style="display:none;position:fixed;inset:0;background:rgba(33,37,41,.8);z-index:1050;">
      <div class="d-flex align-items-center justify-content-center h-100">
        <div role="status" aria-live="polite" class="text-center text-light">
          <div class="spinner-border text-light" style="width:3rem;height:3rem;" aria-hidden="true"></div>
          <div class="mt-3 fw-semibold">Procesando, por favor espera...</div>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/">WifiScanner Web</a>
        <div class="navbar-nav me-auto">
          <a class="nav-link" href="/speedtest/">Speed Test</a>
          <a class="nav-link" href="/devices/">Dispositivos</a>
          <a class="nav-link" href="/wifi/">WiFi</a>
          <a class="nav-link" href="/report/">Reporte</a>
          <a class="nav-link" href="/traffic/">Tr&aacute;fico</a>
          <a class="nav-link" href="/diagnostics/">Diagnóstico</a>
        </div>
        <div class="d-flex">
          {% if request.user.is_authenticated %}
            <span class="navbar-text me-3">Hola, {{ request.user.username }}!</span>
            <a class="btn btn-outline-light btn-sm" href="/accounts/logout/">Salir</a>
          {% else %}
            <a class="btn btn-outline-light btn-sm me-2" href="/accounts/login/">Ingresar</a>
            <a class="btn btn-primary btn-sm" href="/signup/">Crear cuenta</a>
          {% endif %}
        </div>
      </div>
    </nav>
    <main class="container py-4">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
      {% block content %}{% endblock %}
    </main>
    <script>
      (function(){
        function showOverlay(){ var el = document.getElementById('loadingOverlay'); if (el) el.style.display='block'; }
        function hideOverlay(){ var el = document.getElementById('loadingOverlay'); if (el) el.style.display='none'; }
        window.addEventListener('pageshow', hideOverlay);
        document.addEventListener('DOMContentLoaded', function(){
          var heavy = /^(\/speedtest\/|\/devices\/|\/wifi\/|\/traffic\/)$/;
          document.body.addEventListener('click', function(e){
            var a = e.target && e.target.closest ? e.target.closest('a[href]') : null;
            if(!a) return;
            try {
              var href = a.getAttribute('href') || '';
              if (!heavy.test(href)) return;
              if (e.button !== 0 || e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
              showOverlay();
            } catch(_) {}
          });
        });
      })();
    </script>
  </body>
</html>
